\documentclass[12pt]{report}
\usepackage{consumer_resource_final}
\graphicspath{{./figures/}}

\begin{document}


\subsection{Conditions on the model parameters}
Although many studies focus on the study of systems described by random $\gamma, \sigma$ or $\alpha$ matrices [\textbf{insert ref}], we will focus on systems that respect physical or biological constraints given below. Those systems are called \textit{feasible}.

% \paragraph{Energy conservation/dissipation}
% The first condition we will impose on our systems is that they do not create new matter.
%
% Remember that in our model, the total amount of biomass given to the species $i$ by the resources is $\sum_\nu \gamma_{i\nu}R_\nu S_i$.
% However species $i$ will not allocate all of this biomass to growth. As seen in Eq.\eqref{eq : differential eq for species}, only a fraction $\sigma_{i\nu}$ will be used in this purpose. This means species $i$ disposes of $\sum_\nu(1-\sigma_{i\mu})\gamma_{i\mu}R_\mu S_i$ biomass to complete other processes.
% We know that one of these is producing byproducts (\ie the syntrophic interaction) at a total rate $\sum_\nu \alpha_{\nu i} S_i$. Because this biomass is produced in the cell, it has to come from the biomass the cell disposes of, which naturally leads to the condition\footnote{Note that the condition is a bit relaxed here. Biomass cannot be created at equilibrium. However we allow some transient regimes where this momentarily can occur, \eg after a big shock inflicted to the system.}:
%   \begin{equation}
%   \sum_{\nu} \left(1-\sigma_{i\nu}\right)\gamma_{i\nu}R^*_\nu \geq \sum_\nu \alpha_{\nu i} \label{eq : dissipation constraint}
% \end{equation}
% The above equation will be referred to as the \textit{conservation of biomass constraint}.
%
% The idea is to find metaparameters such that this constraint is automatically satisfied (which eases building the system numerically). This is easily done by finding the minimum of the LHS and maximum of RHS of Eq.\eqref{eq : dissipation constraint}. Indeed :
% \begin{equation}
%   \sum_{\nu} \left(1-\sigma_{i\nu}\right)\gamma_{i\nu}R^*_\nu \geq (1-\maxd{\sigma})\mind{\gamma}\mind{R^*},
% \end{equation}
% where \ $\mind{ }$ \ denotes the minimum value of the random variable and \ $\maxd{ }$ \ its maximum value. On the other hand,
% \begin{equation}
%   \sum_\nu \alpha_{\nu i} \leq \maxd{\alpha} N_R.
% \end{equation}
% This means that if we take metaparameters such that
% \begin{equation}
%   \maxd{\alpha} N_R < (1-\maxd{\sigma})\mind{\gamma}\mind{R^*}, \label{eq : min and max energy constraint}
% \end{equation}
% then Eq.\eqref{eq : dissipation constraint} is automatically followed.
%
% Because of the way we choose our variables we have for every random variable in the problem,
% \begin{equation}
% \mind{X} = (1-\epsilon)\mean{X} \text{ and }\maxd{X} = (1+\epsilon)\mean{X}
% \end{equation}
% where \ $\mean{X}$ \ denotes the mean of $X$. This means Eq.\eqref{eq : min and max energy constraint} is equivalent to, in terms of metaparameters:
% \begin{equation}
%   \alpha_0 < \frac{\left(1-\epsilon\right)^2}{1+\epsilon}\left(1-\left(1+\epsilon\right)\sigma_0\right)\frac{\gamma_0 R_0}{N_R}.
% \end{equation}
% In the $\epsilon \ll 1$ limit, this is equivalent to:
% \begin{equation}
%   \alpha_0 < \left(1-3\epsilon\right)\left(1-(1+\epsilon)\sigma_0\right)\frac{\gamma_0 R_0}{N_R}.
% \end{equation}
% % \begin{equation}
% %   \sum_{\nu} \left(1-\sigma_{i\nu}\right)\gamma_{i\nu}R^*_\nu \geq \min_\nu\left(\left(1-\sigma_{i\nu}\right)R^*_\nu\right) \sum_\nu \gamma_{i\nu} \geq \left(1-\max_\nu\left(\sigma_{i\nu}\right)\right)\min_\nu\left(R^*_\nu\right)N_R \gamma_0.
% % \end{equation}
% % Now, the way we draw the $\sigma_{i\nu}$ numerically is effectively by drawing elements of a uniform distribution of mean $\sigma_0$, i.e.
% % \begin{equation}
% %   \sigma_{i\nu} \approx \text{Unif}(0, 2\sigma_0).
% % \end{equation}
% % It is quite easy to estimate $\max_\nu(\sigma_{i\nu})$, indeed we can easily show that :
% % \begin{equation}
% %   E\left[\max_\nu\left(\sigma_{i\nu}\right)\right] = 2 \sigma_0 \frac{N_R}{N_R+1}.
% % \end{equation}
% % This has a standard deviation
% % \begin{equation}
% %   \tilde{\sigma} = \frac{2 \sigma_0}{N_R+1}\sqrt{\frac{N_R}{N_R+2}}.
% % \end{equation}
% % Similarly one can show that if
% % \begin{equation}
% %   R^*_\nu \approx \text{Unif}(0,2R_0),
% % \end{equation}
% % then
% % \begin{equation}
% %   E\left[\min_\nu \left(R^*_\nu\right)\right]  = \frac{2R_0}{N_R+1}.
% % \end{equation}
% % Then we can estimate
% % \begin{equation}
% %   \left(1-\max_\nu\left(\sigma_{i\nu}\right)\right)\min_\nu\left(R^*_\nu\right)N_R \gamma_0 \approx 2R_0\gamma_0\left(1-2\sigma_0 \frac{N_R}{N_R+1}\right)\frac{N_R}{N_R+1}
% % \end{equation}
% % We now find an upperbound for the RHS of Eq.\eqref{eq : dissipation constraint} :
% % \begin{equation}
% %   \sum_\nu \alpha_{\nu i}  \leq \sum_\nu \max_\nu\left(\alpha_{\nu i}\right) \approx 2\alpha_0 \frac{N_R}{N_R+1} N_R.
% % \end{equation}
% % This means that if we pick metaparameters verifying :
% % \begin{equation}
% %   R_0 \gamma_0 \left(1-2\sigma_0\frac{N_R}{N_R+1}\right) \gg \alpha_0 N_R.
% % \end{equation}
% % In the $N_R \gg 1$ limit :
% % \begin{equation}
% %   \frac{\gamma_0}{\alpha_0} \gg \frac{N_R}{R_0(1-2\sigma_0)}.
% % \end{equation}
% % This condition allows us to pick metaparameters that we know will satisfy the energy constraint most of the time. This is done solely to speed up computation time (energy constraint is checked anyway while building the system).
%
% \paragraph{Positivity of the parameters}
% Feasability means at least that every physical parameter defined here must be positive. In particular, this implies:
% \begin{equation}
%   d_i > 0 \implies \sum_\mu \sigma_{i\mu}\gamma_{i\mu}R^*_\mu > \sum_\mu \tau_{\mu i}
% \end{equation}
% If $\tau_{i\mu} = 0.$ this is trivially satisfied because $\sigma_{i\mu}$, $\gamma_{i\mu}$ and $R^*_\mu$ have all been drawn positive. However if $\tau_{\mu i} = \alpha_{\mu i}$ this is not always the case and we have to get parameters satisfying :
% \begin{equation}
%   \sum_\mu \sigma_{i \mu} \gamma_{i\mu}R^*_\mu > \sum_{\mu} \alpha_{\mu i}\text{ }\forall i.
% \end{equation}
% We can try to estimate the value of some metaparameters that would satisfy this.
% We have :
% \begin{equation}
%   \sum_\mu \sigma_{i\mu} \gamma_{i\mu} R^*_\mu \geq \mind{\sigma}\mind{\gamma}\mind{R^*}.
% \end{equation}
% Using this boundary and Eq.\eqref{eq : min and max energy constraint}, we know that $d_i>0$ if
% \begin{equation}
%   \maxd{\alpha}N_R \leq \mind{\sigma} \mind{\gamma}\mind{R^*},
% \end{equation}
% \ie
% \begin{equation}
%   \alpha_0 < \frac{\left(1-\epsilon\right)^3}{1+\epsilon} \frac{\sigma_0 \gamma_0 R_0}{N_R},
% \end{equation}
% or in the $\epsilon \ll 1$ limit :
% \begin{equation}
%   \alpha_0 < \left(1-4\epsilon\right)\frac{\sigma_0 \gamma_0 R_0}{N_R}.
% \end{equation}
% Similarly we must have a positive death rate for the resources, \ie:
% \begin{equation}
%   m_\nu = \frac{l_\nu-\sum_j \gamma_{j\nu} R^*_\nu S^*_j+\sum_j \alpha_{\nu j} S^*_j}{R^*_\nu} > 0. \label{eq : positive m_nu}
% \end{equation}
% This means we have to impose parameters that verify:
% \begin{equation}
%   l_\nu + \sum_j \alpha_{\nu j}S^*_j > \sum_j \gamma_{j \nu}R^*_\nu S^*_j.
% \end{equation}
% We can do a reasoning similar to before, \ie find a lower boundary for the LHS and an upper boundary for the RHS.
% We have
% \begin{equation}
%   l_\nu + \sum_{j} \alpha_{\nu j} S^*_j \geq \mind{l} + \mind{\alpha} \mind{S^*}
% \end{equation}
% and
% \begin{equation}
%   \sum_j \gamma_{j\nu}R^*_\nu S^*_j \leq N_S \maxd{\gamma}\maxd{R^*}\maxd{S^*}.
% \end{equation}
% Hence if we get parameters satisfying
% \begin{equation}
%   \mind{l}+\mind{\alpha}\mind{S^*} > N_S \maxd{\gamma}\maxd{R^*}\maxd{S^*},
% \end{equation}
% then Eq.\eqref{eq : positive m_nu} will be immediately satisfied. In terms of metaparameters this is equivalent to:
% \begin{equation}
%   \alpha_0 > \frac{N_S \gamma_0 R_0 S_0 (1+\epsilon)^3-l_0 (1-\epsilon)}{S_0 (1-\epsilon)^2}.\label{eq : alpha lowerbound 0}
% \end{equation}
% In the $\epsilon \ll 1$ limit this is equivalent to:
% \begin{equation}
%   \alpha_0 > \left(1+5\epsilon\right)N_S \gamma_0 R_0 - \left(1+\epsilon\right)\frac{l_0}{S_0}.
% \end{equation}
% (Interesting, if $l_0/S_0$ is large enough, \ie "there is enough food for everyone" then this condition is irrelevant).
% % Indeed,
% % \begin{equation}
% %   \sum_\mu \alpha_{\mu i} \leq \sum_\mu \max_\mu \left(\alpha_{\mu i}\right) \approx 2\alpha_0 \frac{N_R}{N_R+1} N_R \text{
% %     (see above).
% %   }
% % \end{equation}
% % Similarly,
% % \begin{equation}
% %   \sum_{\mu} \sigma_{i\mu}\gamma_{i\mu}R^*_\mu \geq \min_\mu\left(\sigma_{i\mu}R^*_\mu\right)\sum_\mu \gamma_{i\mu} \geq \min_\mu\left(\sigma_{i\mu}\right)\min_\mu\left(R^*_\mu\right) N_R \gamma_0.
% % \end{equation}
% % Using the estimations for $\min_\mu\left(\sigma_{i\mu}\right)$ and $\min_\mu\left(R^*_\mu\right)$ :
% %  \begin{equation}
% %    \min_\mu\left(\sigma_{i\mu}\right) \approx E\left[\min_\mu\left(\sigma_{i\mu}\right)\right] = \frac{2 \sigma_0}{N_R+1}\text{, }\min_\mu\left(R^*_\mu\right) \approx E\left[\min_\mu\left(R^*_\mu \right)\right] = \frac{2 R_0}{N_R+1}
% %  \end{equation}
% %  This means we have to take :
% %  \begin{equation}
% %    \frac{\gamma_0}{\alpha_0} \gg \frac{N_R(N_R+1)}{2\sigma_0 R_0}.
% %  \end{equation}
%
% \paragraph{Combining conditions}
% If we combine both upperbounds we get a restriction on the metaparameters:
% % \begin{equation}
% %   \frac{\gamma_0}{\alpha_0} \gg \max\left(\frac{N_R(N_R+1)}{2\sigma_0 R_0}, \frac{N_R}{R_0(1-2\sigma_0)}\right)
% % \end{equation}
% % To get an idea on the order of magnitude of the ratio $\gamma_0/\alpha_0$ (\ie our order parameter), if we work with $N_R = 25$, $\sigma_0 = 0.2$, $R_0 = 1$, we have
% % \begin{equation}
% %   \frac{N_R(N_R+1)}{2\sigma_0 R_0} = 1'625 \text{ and } \frac{N_R}{R_0(1-2\sigma_0)} \approx 42
% % \end{equation}
% % \ie we will need, if $\gamma_0 \approx 1$
% % \begin{equation}
% %   \alpha_0 \ll 6.1 \times 10^{-4}.
% % \end{equation}
% % That means only very small metabolite release (this is indeed what we observe numerically).
% \begin{subequations}\label{eq : alpha bounds}
% \begin{equation}
% \alpha_0 < \min\left(\frac{\left(1-\epsilon\right)^2}{1+\epsilon}\left(1-\left(1+\epsilon\right)\sigma_0\right)\frac{\gamma_0 R_0}{N_R}, \frac{\left(1-\epsilon\right)^3}{1+\epsilon} \frac{\sigma_0 \gamma_0 R_0}{N_R}\right). \label{eq : alpha upperbound}
% \end{equation}
% We of course also get a restriction on the lowerbound of $\alpha_0$ through Eq.\eqref{eq : alpha lowerbound 0}:
% \begin{equation}
%   \alpha_0 > \frac{N_S \gamma_0 R_0 S_0 (1+\epsilon)^3-l_0 (1-\epsilon)}{S_0 (1-\epsilon)^2}. \label{eq : alpha lowerbound}
% \end{equation}
% \end{subequations}
% To get an idea on the order of magnitude of $\alpha_0$ (which will be our order parameter if $\gamma_0=1$), we have for $N_R=25$, $\sigma_0 = 0.2$, $R_0 = 1$ and $\epsilon=0.1$ :
% \begin{equation}
%   \alpha_0 < 5.3 \times 10^{-3}.
% \end{equation}
% So what we see in Eq.\eqref{eq : alpha upperbound} is that $\alpha_0$ has an upper bound which is dictated either by energy conservation or system feasability. What relations do the metaparameters have to fulfill in these two different regimes?
%
% Suppose that the limiting factor is system feasability. That means:
% \begin{empheq}{align}
%    \frac{\left(1-\epsilon\right)^3}{1+\epsilon} \frac{\sigma_0 \gamma_0 R_0}{N_R} &\leq \frac{\left(1-\epsilon\right)^2}{1+\epsilon}\left(1-\left(1+\epsilon\right)\sigma_0\right)\frac{\gamma_0 R_0}{N_R} \nonumber \\
%   \iff  (1-\epsilon) \sigma_0 &\leq 1-(1+\epsilon)\sigma_0 \nonumber\\
%   \iff \sigma_0 &\leq \frac{1}{2}
% \end{empheq}
% This means if $\sigma_0 \leq \frac{1}{2}$, the limiting factor will be system feasability while if $\sigma_0 \geq \frac{1}{2}$, it will be energy conservation.
\subsection{Feasability conditions}
The previous feasability conditions can be significantly improved.
\paragraph{Energy conservation/dissipation}
As stated before, energy conservation is the condition that the biomass you release is not greater than what you have left after you grew:
\begin{equation}
\sum_\nu \left(1-\sigma_{i\nu}\right)\gamma_{i\nu}R^*_\nu \geq \sum_\nu \alpha_{\nu i} \ \forall i=1,\dots, N_S \label{eq : feasability energy conservation}
\end{equation}
We use (neglecting the variances of every quantity involved):
\begin{equation}
\sum_\nu \alpha_{\nu i} \approx k_i^\alpha \alpha_0
\end{equation}
where $k_i^\alpha$ is the degree of the $i$-th column of the alpha matrix.
Similarly,
\begin{equation}
\sum_\nu \left(1-\sigma_{i\nu}\right)\gamma_{i\nu} R^*_\nu \approx (1-\sigma_0)R_0\sum_{\nu}\gamma_{i\nu} \approx k_i^\gamma(1-\sigma_0)R_0\gamma_0,
\end{equation}
where $k_i^\gamma$ is the degree of the $i-$th row of the $\gamma$ matrix.
Then energy conservation Eq.\eqref{eq : feasability energy conservation} is equivalent to
\begin{equation}
k_i^\alpha \alpha_0 \lessapprox k_i^\gamma (1-\sigma_0)R_0\gamma_0 \ \forall i=1,...,N_S
\end{equation}
Since $k_i^\gamma > 0 $ (it is the number of resources species $i$ eats), we have:
\begin{equation}
\frac{k_i^\alpha}{k_i^\gamma} \alpha_0 \lessapprox (1-\sigma_0)R_0\gamma_0 \ \forall i=1,...,N_S
\end{equation}
This is fulfilled if :
\begin{equation}\label{eq: feasability energy conservation}
\boxed{
\max_i\left\{\frac{k_i^\alpha}{k_i^\gamma}\right\} \alpha_0 \lessapprox (1-\sigma_0)R_0 \gamma_0
}
\end{equation}
What this basically says is that systems where the ratio $\frac{\# \text{resources released to}}{\# \text{resources consumed}}$ is small for each species allow for a larger individual syntrophy interaction (which is very intuitive).
\paragraph{Positivity of the parameters}
As said before, the death rates have to be positive:
\begin{equation}
\sum_\mu \sigma_{i\mu}\gamma_{i\mu}R^*_\mu > \sum_\mu \tau_{\mu i}
\end{equation}
Using a similar reasoning :
\begin{equation} \label{eq : feasability positivity d}
\boxed{
\max_i\left\{\frac{k_i^\alpha}{k_i^\gamma}\right\} \alpha_0 \lessapprox \sigma_0R_0 \gamma_0
}
\end{equation}
Also for $m_\nu$ to be positive we need:
\begin{equation}
l_\nu + \sum_j \alpha_{\nu j} S^*_j > \sum_j \gamma_{j\nu}R^*_\nu S^*_j \ \forall \nu=1,\dots,N_R
\end{equation}
Which is equivalent to
\begin{equation}
l_0 + k_\nu^\alpha \alpha_0 S_0 \gtrapprox k_\nu^\gamma \gamma_0 R_0 S_0 \ \forall \nu
\end{equation}
Since $k_\nu^\gamma>0$ (every resource is at least consumed by one species), the $N_R$ equations above can be rewritten as:
\begin{equation} \label{eq : feasability positivity m}
\boxed{
\min_\nu\left\{\frac{l_0}{k_\nu^\gamma S_0} + \frac{k_\nu^\alpha}{k_\nu^\gamma}\alpha_0\right\} \gtrapprox \gamma_0 R_0
}
\end{equation}
This says that systems where the ratio $\frac{\#\text{number of species that release to me}}{\#\text{number of species that consume me}}$ is large for every resource are more feasible. The strategy should be then to have $\gamma$'s that have large $k^\gamma_\nu$ (\ie resources are consumed by many species) and large $k_i^\gamma$ (\ie species consume a lot of species), and the other way around for $\alpha$ (not sure about this for the last one).

\subsubsection{Combining the feasability conditions}
The two upper bounds Eqs.\eqref{eq : feasability energy conservation}-\eqref{eq : feasability positivity d} on $\alpha_0$ can be combined in a single inequality :
\begin{equation} \label{eq : largest feasible alpha0 with structure}
\max_i{\frac{k_i^\alpha}{k_i^\gamma}} \alpha_0 \lessapprox \min(1-\sigma_0, \sigma_0) \gamma_0 R_0
\end{equation}
Note that when $\alpha_0 > 0$, we will trivially require that the syntrophy matrix is not empty, \ie there exists at least an $i$ for which $k_i^\alpha \geq 1$. Note also that the largest value $k_i^\gamma$ can get (for any $i$) is $N_R$. Hence,
\begin{equation}
\max_i\left\{ \frac{k_i^\alpha}{k_i^\gamma} \right\} \geq \frac{1}{N_R},
\end{equation}
and we can find a largest allowed theoretical non-zero $\alpha_0$ :
\begin{equation}
\alpha_0 \lessapprox \min(1-\sigma_0, \sigma_0) \gamma_0 R_0 N_R. \label{eq : largest feasible alpha0}
\end{equation}
Finally, Eq.\eqref{eq : largest feasible alpha0 with structure} and \eqref{eq : feasability positivity m} can be combined into a single one, which gives us the volume of the metaparameters space that make the system feasible:
\begin{equation}
\boxed{
\max_i\left\{\frac{k_i^\alpha}{k_i^\gamma}\right\} \alpha_0
\lessapprox \min(1-\sigma_0, \sigma_0) \gamma_0 R_0
\lessapprox
\min \left(1-\sigma_0, \sigma_0 \right) \min_\nu \left\{ \frac{l_0}{k_\nu^\gamma S_0} + \frac{k_\nu^\alpha}{k_\nu^\gamma}\alpha_0\right\}
}\label{eq : overall feasability constraint metaparameters}
\end{equation}

\end{document}
