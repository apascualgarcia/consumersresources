\documentclass[12pt, titlepage]{report}
\usepackage{consumer_resource_final}
\graphicspath{{./figures/}}

\begin{document}

% OLD DISCUSSION : NEW IS BELOW
% Structure of this:
% - Results of the project:
%   - LRI scenario:
%     - Found a regime where dynamical stability is ensured!
%     - However, hard to know when such a regime could be attained so designed an algorithmic procedure to find regimes as close to this as possible
%     - The outcome of that was an improvement of dynamical stability compared to a fully connected syntrophy matrix but only for matrices at low connectance (probably because Rc grows fast with the connectance so definitely harder for the inequality to be fulfilled)
%     - The next step would be to try with other, less heuristic forms of energy, eg some that take into account how Rc changes with A (since we neglected this)
% The first significant result of this Thesis was the derivation of the equations that describe the metaparameters space domain in which feasibility is ensured. This allowed us to accurately predict how syntrophy affects feasibility of microbial communities and told us the relevant zone of metaparameters, which prevented us from dealing with unfeasible systems.
% We then discovered a special regime of parameters, named ``strong LRI regime'', which we proved is dynamically stable. This led to the development of the MCMC ``LRI'' algorithm which goal is, for a given set of metaparameters and a consumption matrix, to generate the syntrophy matrix that brings microbial communities as close as possible to the strong LRI regime. Typically, the syntrophy matrices obtained through that algorithmic procedure are very nested, such that the species which consume few resources end up releasing a lot of them and vice-versa. However, computations in Methods \ref{sec: dynamical stability methods fully dynamically stable region} showed that the goal behind the LRI algorithm is only partially achieved: microbial communities in the LRI syntrophic scenario can bear a larger syntrophic interaction while remaining dynamically stable -- compared to the ``null case'' of a fully connected syntrophy matrix -- but only if the average number of resources consumed by each consumer is low. Why the LRI scenario is inefficient at high consumption matrix connectance is for now largely unknown. It could be due to feasibility considerations. It is indeed still unclear in which conditions the strong LRI regime is feasible, and it may happen that when the connectance of the consumption matrix is too large, such a regime simply cannot exist\footnote{More specifically, the critical radius $R_C$ strongly depends on the shape of the consumption matrix and gets larger as its connectance increases. It is possible that beyond a certain connectance, $R_C$ gets too large and the inequality of Theorem \ref{theorem: strong LRI regime} cannot be fulfilled anymore.}. It could also come from the choice of the energy function used in the MCMC LRI algorithm. That energy was indeed obtained in a heuristic way that neglected some factors, especially the role of the critical radius and its dependency on the shape of the syntrophy matrix, and could be improved in a future work.
%
% %   - Microbial communities where number of resources=number of consumers and syntrophy matrix is fully connected?:
% We subsequently focused on studying large communities comprised of twenty-five microbial species and the same number of resources.
% %     - feasibility:
% %       - found a limit: contrarily to simpler models, feasibility restricts your possible metaparameters -> lose the liberty of choosing which makes the study harder
% %       - the most feasible points (ie where we expect real microbial communities to exist) have high consumption rates and low equilibrium abundances -> flaw of the model here : by extrapolating results feasibility should be larger for S0->0 which is not realistic: need an upperbound for S0 or g0! (can argue that g0 cannot take any value and is somehow bounded by other biological conditions independent of the model (g0 should be determined through the help of another model cite papers that could help))
% %       - systems where consumption matrix is more connected and less nested are the ones that can most support syntrophy
% We predicted analytically that imposing the fulfillment of simple physical conditions restricts quite much the range of possible metaparameters. This was confirmed numerically: not all configurations have an equal chance of existing. Indeed in the absence of syntrophy we observe for all consumption networks a trade-off between average consumption rate and abundance of consumers in the sense that the overall proportion of resources consumed by the microbial species is bounded: there are no regimes where {a lot of microbes} eat very aggressively. If we want to increase the consumption rate beyond a certain threshold, the abundance of consumers has to be reduced, and the other way around. Adding a syntrophic mean-field interaction\footnote{That is a fully connected $A$ matrix (FC scenario).} breaks the symmetry of that trade-off: whatever the shape of the consumption network, as syntrophy increases only microbial species in low abundance that consume their resources at high rates can coexist\textbf{TO DO : check if there is any literature on this}. Moreover, communities where the average number of resources eaten by a consumer is large, under the caveat that there should be a small consumption overlap, are the ones which existence is least impacted by syntrophy\textbf{TO DO: check if there is literature saying that LV systems are less feasible when nestedness is high, rephrase this better if possible}.
%
% %     - dynamical stability:
% %       - follows the same trend as feasibility: systems with high g0 and low S0 are more dynamically stable than others, however we did not find any pattern in which feasibility -> dynamical stability
% %       - we found that feasibility and dynamical stability ``have the same trend'' by which we mean systems that are most feasible are most dynamically stable: these again have a large gamma0 and a small S0
% %       - at the same syntrophy: the points with S0 as large as possible (ie where S0 ~ g0 are{-1}) are the most dynamically stable (dynamical stability largest at the boundary of the feasible volume)
% %       - interesting effect of syntrophy: as syntrophy increases, dynamical stability is improved (main eigenvalue has a larger magnitude (but still is negative)), but on fewer points: gives a ``fine tuning effect''
% %       - systems where consumption matrix is more connected and less nested are the ones that can most support syntrophy and remain dynamically stable.
%
% Whereas the feasibility region offered a fairly simple topology -- the metaparameters space was made of two very clear regions of either complete feasibility\footnote{By ``complete feasibility'', we mean that the metaparameters feasibility function is equal to 1: all parameters set that we build from this region of the metaparameters space are feasible for certain.} or complete unfeasibility separated by a narrow area of mixed feasibility -- the dynamical stability region presented a fractured landscape made of many almost dynamically stable points.
% %Because it was required from a metaparameters set that it be fully feasible in order to determine its probability of being dynamically stable, we unsurpisingly observed a shrinkage of the dynamical stability region as syntrophy is increased.
% Surprisingly enough, a similar trend as feasibility was observed: irrespective of the topology of the consumption matrix, microbial communities which have at equilibrium only a scarce abundance of consumers which consume their resources at a high rate are the least impacted by syntrophy in terms of their dynamical stability. In general, as for the case of feasibility, microbial communities with highly connected consumption matrices with few syntrophic overlap are the ones which dynamical stability region is least impacted by the addition of a syntrophic interaction. However, even if the same trend is observed, not all points of the metaparameters space which are feasible also are dynamically stable. On the contrary, %for no consumption-syntrophy network did we find that feasibility implied dynamical stability for \important{all points} of the metaparameters space.
% feasibility does not imply dynamical stability in general: for all networks we found some region of the metaparameters space that was feasible but not dynamically stable.
% A detailed study of exactly which sectors of the metaparameters space give rise to feasible communities that are always dynamically stable remains to be conducted. Among the points which we know are dynamically stable we were able to determine analytically (and that was confirmed by simulations) that the points at the upper border of the dynamical stability region are the most dynamically stable -- in the sense that they take the least time to recover from perturbations of their abundances.
%
% Another trade-off worth mentioning is the one between the size of dynamical stability region and ``the speed of recovery'' following perturbations. Indeed as syntrophy is increased, the size of the dynamically stable region shrinks\footnote{Among others, because of the feasibility requirements.} but the average largest real part of the spectrum of the jacobians observed within the dynamically stable region\textbf{TO DO : see exactly how that max is computed} increases. In short when the syntrophic interaction is raised, there are fewer dynamically stable points, but their stability also grows. This means we expect microbial communities where a large syntrophic interaction is observed to be fairly fine tuned.
%
% %     - structural stability:
% %       - placed ourselves at the most dynamically stable points for all
% %       - defined the critical dynamical syntrophy at that point as the largest syntrophy for which we have full dynamical stability AT THAT POINT. (how does the dynamical critical syntrophy change? tells what structure for your syntrophy matrix)
% %       - study environmental perturbations in these conditions: in the absence of syntrophy, systems with a consumption matrix less nested and more connected can survive larger environmental perturbations
% %       - how does having syntrophy impact the system? it does not impact noticeably (maybe too much of a fine tuning effect) except if the structure is NIS -> comparing this with the other regimes, suggests you should release to as many people as you can but most importantly NOT TO YOU
% %       - interesting trade-off between structural stability and dynamical stability in the structure of the syntrophy matrix : if you want to be more structurally stable should be NIS but if you want to be more dynamically stable should be RS
% The study of structural stability, \ie the impact of environmental perturbations, formed the final part of this Thesis. Because of reasons explained in the text, we decided to move to a system where the number of resources are doubled and the number of consumers is fixed. We chose a highly dynamically stable point of the metaparameters space and started by computing the critical dynamical syntrophy -- the largest syntrophy such that we observe dynamically stable parameters with a probability of one -- of each consumption-syntrophy network. In conformity with the trend hithertho observed, consumption matrices with a large connectance and a small ecological overlap can achieve the largest critical dynamical syntrophy. We then compared how microbial communities react to environmental perturbations in three different cases: as a null case, without syntrophy, then at their own critical dynamical syntrophy and as a ``fairer'' point of comparison, at the minimal critical dynamical syntrophy (\ie the largest syntrophic interaction which can be sustained by all the matrices we considered). In all cases, we observed that, as for dynamical stability, the communities with a highly connected consumption matrix with little ecological overlap can recover from the largest environmental perturbations, which allows us to draw the conclusion that as regard to the shape \textbf{TO DO: Alberto's remark: the fact that syntrophy does not clearly improve structural stability contrasts with LV models, but there resources are implicit, here are explicit and continuously supplied, this environment seems too benign to benefit syntrophy} of the consumption matrix dynamical and structural stability go hand in hand. Moreover, we were surprised to observe that -- except for one specific scenario -- syntrophy does not significantly impact structural stability of microbial communities, whether it was at the critical dynamical syntrophy of each network or at the minimal critical dynamical syntrophy. The only scenario where adding a syntrophic interaction undoubtedly increased structural stability was if the syntrophy was at its largest possible value (critical dynamical syntrophy) and the topology of the syntrophy matrix is such that consumers release every resource except the ones they do not feed on. That result is very surprising to us because we observed that a random structure of the syntrophy matrix allowed a larger critical dynamical syntrophy, \ie a larger syntrophic interaction without a loss of dynamical stability. That fact hints at a trade-off between dynamical and structural stability in terms of the shape of the syntrophy network that deserves to be explored in future studies \textbf{TO DO: to be sure of this should measure largest eigenvalue at that specific point for the different scenarios}.
%
% %   - what is the effect of changing the structure of A?
% %       - check for feasibility
% %       - for dynamical stability: RS provides a better way to survive syntrophy, LRI also changes but only for low connectance consumption matrix
% %       - for structural stability: no significant difference again except in the NIS case and at own critical dynamical syntrophy
% So the shape of the syntrophy matrix has an effect on the structural stability of the system but it also affects feasibility and dynamical stability. While it surprisingly does not affect much the shape of the fully feasible region, it changes each consumption network's feasibility in a non trivial way. Overall we do not observe any significant increase of feasibility\footnote{By ``increase of feasibility'' we mean ``decrease of the feasibility decay rate''.} for the NIS regime compared to the FC case, except for one particular lowly connected \textbf{TO DO : change here} and lowly nested consumption matrix and highly connected highly nested consumption matrices. On the other hand, the LRI scenario greatly improves feasibility for lowly connected consumption networks but does not provide any significant change at high connectance. Finally, a random structure of the syntrohy matrix (RS regime) consistently improves feasibility, the lower the connectance of the consumption matrix, the larger the improvement. The same remarks hold for dynamical stability. The common ground between these cases is that the syntrophy matrix is lowly connected. Even though the reasons behind that behaviour remain unclear this hints that syntrophy matrices with a lower connectance enable a larger tolerance towards the addition of a syntrophic interaction.
%
% %   - what is the effect of changing the number of resources?
% %       - check this precisely but should be:
% %       - feasibility : restricts common feasible volume (is it because of patchiness? should be investigated)
% %       - dynamical stability : does improve the stability by lowering eigenvalue? and removes patchiness -> easier to work with.
%
% All the previous conclusions are drawn for a system where the number of consumers is equal to the number of resources. There is however little reason that such systems should be prevalent in nature which begs the question of the consequences of changing \eg the number of resources while keeping the number of consumers fixed. We roughly investigated what happens when the number resources goes from twenty-five to fifty. Interestingly enough, this reduces the common fully feasible region such that the largest syntrophy that \important{all} consumption-syntrophy can attain is lessened. However we also observed that doubling the number of resources does not -- on average -- significantly change the feasibility decay rate of each matrix. These contrasting conclusions, which may be due to a change of the profile of the feasibility function across the consumption rate-consumers abundance, need more investigation\textbf{TO DO: check maybe an error in the code}. As for the case of dynamical stability, interestingly enough adding more resources smoothes out the fully dynamically stable region, which eliminates most of the almost dynamically stable points and in turn allows for a common fully dynamically stable region at syntrophies larger than zero. Although the dynamical stability decay rate is on average left unchanged, there are hints that stability is increased (\ie the largest real part of the spectrum is increased) when the number of resources is augmented, which is in accordance with the classical ecology literature \textbf{TO DO : cite here}. In any case, the effect of the number of resources of a microbial community remains an interesting open topic.
% % - What could be improved:
% %   - definitely the LRI regime deserves more introspection: first of all study exactly in what conditions it can happen (this wasn't done thoroughly) and find a better expression for the energy
%
% Although some progress on the subject of the impact of syntrophy on microbial communities was made with this Thesis, many aspects of the problem remain obscure. The first next step is of course to confront the results we obtained with experimental data \textbf{TO DO : be aware, worked in chemostat}.
% For instance, multiple considerations explained above lead us to expect that syntrophic microbial communities in Nature should have a low abundance of consumers at equilibrium (compared to the abundance of resources) which consume their resources at a high rate, with a very connected consumption network with little ecological overlap: how well is that prediction matched with experiments? Also if that is accurate, could microbial models explain the same results through for example an evolutionary model which would allow to bring a more biological hindsight? On the opposite, if our predictions are not matched with experiments, how can we change the model to make it more accurate?
%
% Apart from confrontation with data, future theoretical studies still have significant work to do. For instance, a more exhaustive study of how structural stability changes as a function of the consumption rate and the abundance of consumers would surely provide interesting results: are there zones of the metaparameters space that are much sensible to perturbations of the consumers and the resources but not to environmental changes? Are there regimes that can sustain any perturbation at any intensity?
% However, in our opinion future works in the microbial ecology field should put their focus on finding the exact order parameter of the syntrophy matrix topology that drives the stability of this model.\textbf{TO DO : rephrase this: a bit rough as a final sentence}
%
% % - What should be done in the future:
% %   - more exhaustive study of structural stability, how does it change as a function of consumption rate and consumers equilibrium?
% %   - produce a more thorough study of the influence of the structure of the syntrophy matrix on all quantities: would allow for a fairer comparison (indeed we only considered ``scenarios'')
% %   - confront the results with data
% %

%% FIRST RELATE WITH THE LITERATURE AND EXPLAIN WHY WHAT WE ARE DOING IS IMPORTANT
The studies conducted in this Thesis allowed us to gain a more precise knowledge on the impact of syntrophy on microbial communities. Although microbial communities are present in a very large number of diverse ecosystems \cite{ley_worlds_2008, becerra-castro_wastewater_2015, falkowski_biogeochemical_1998}, our grasp of their functioning is yet very crude and an improvement of the underlying mechanisms that govern their shaping may lead us to technological breakthroughs \cite{kashyap_microbiome_2017}.
%% MOST IMPORTANT RESULTS
We found four important results which seem to be determinant in the dynamics of microbial communities as dictated by our model: biological tradeoffs play an essential role, both in the absence and presence of syntrophy; syntrophy increases dynamical stability and -- except under very specific conditions -- neither increases nor decreases structural stability; finally, the topology of both the matrices at play is one of the main factors of the dynamics.

% 1) Trade-offs govern the behaviour, with and without syntrophy:
%   - in the absence of syntrophy: feasibility implies a tradeoff for the consumers between consumption uptake and abundance at equilibrium
%   - when syntrophy is introduced: tradeoff between largest eigenvalue and size of feasible metaparameters
%   - finally for structural stability: tradeoff in the structure of the A matrix, if you want a larger ss you must take a shape that is not the one for which you can have the largest syntrophy
%   - link to literature: mention Sebastian's and Hwa's work that mention also that these tradeoffs are critical
Microbial communities are governed by tradeoffs: everything comes with a price.
%Parameters that determine microbial communities follow tradeoffs, with and without syntrophy.
In the absence of syntrophy, we observed that the product of the consumers' consumption uptake and abundance at equilibrium should not exceed a certain threshold. If that threshold is exceeded, the system either does not conserve biomass or has negative parameters, and it simply cannot exist. Feasible systems either have a very high consumption uptake and a low abundance of consumers at equilibrium or the other way around. The introduction of a syntrophic interaction induces an additional tradeoff in the system. On one hand, syntrophy reduces the number of both feasible and dynamically stable points, but on the other, the remaining points are rewarded with a better dynamical stability: they recover faster from perturbations of resources or consumers. A final tradeoff was observed for the case of structural stability. It is essentially a balance between maximal attainable syntrophy and increase in structural stability as a function of the structure of the syntrophy network: the structure of $A$ which allows syntrophy to increase the structural stability of a microbial community is different from the one that allows the same community to withstand the largest syntrophy while remaining dynamically stable. Nature is made of tradeoffs. If it was not we could neither observe the diversity of systems nor the equilibria that we see. As the law of Physics show it, equilibrium comes from the confrontation of two opposite forces and if there existed a configuration of microbial community which was ``optimal'' towards all aspects, we most likely would observe all of them in that state. Although some studies suggest the importance of tradeoffs \cite{pfeiffer_evolutionary_2002, lawrence_species_2012}, to our knowledge a thorough investigation of that question in the context of microbiology remains to be done.

% 2) Syntrophy overall increases dynamical stability:
%   - introduce link to literature with MacArthur and May that says mutualistic are detrimental for stability
We also discovered that, overall, syntrophy increases dynamical stability. As said above, this comes at the price that fewer systems are feasible when dynamical stability increases. That result corroborates the classical notion first claimed by \citeauthor{may_qualitative_1973} that mutualistic interactions -- in our case syntrophy -- are detrimental to dynamical stability \cite{may_qualitative_1973}. Additionally, because syntrophy provides additional pathways for the biomass flow to the consumers, our result also confirms the conclusion of \citeauthor{macarthur_fluctuations_1955} who stated that the larger the number of such pathways, the greater the stability of the community \cite{macarthur_fluctuations_1955}.

% 3) Syntrophy overall does not affect structural stability except under very special circumstances: -> maybe change chemostat link MeCoco paper
Contrarily to dynamical stability, structural stability is in general neither improved nor worsened by syntrophic interactions. Out of the seven scenarios we tested for the structure of the syntrophy matrix, the only one where syntrophy improved the structural stability of the community is when every consumer releases every resource except the ones they themselves feed on. Furthermore, the improvement is more significant as the connectance of the consumption matrix grows. Why syntrophy has an impact only on that scenario remains unclear to us. It is possible that we did not observe any systematic impact of syntrophy because of the assumptions of the model. Indeed we work with microbial communities that are in a chemostat environment. This means that resources available to consumers are constantly added through an external biomass flow. Because in our simulations the external biomass flow was consistently larger than the syntrophic biomass flow by at least two orders of magnitude\footnote{We can approximate the external biomass flow available for each species as $ \sim N_R l_0$. On the other hand the syntrophic flow is $\sim N_R N_S \alpha_0 S_0$. With the values we used $l_0 \approx 1$ and $N_S=25, \alpha_0 \approx 0.01$ and $S_0 \approx 0.05$, the syntrophic flow is way smaller than the external flow.}, the impact of syntrophy might have been too little to even be measured. As recent studies show \cite{pacheco_costless_2019}, the role of syntrophy may be more prominent in environment where resources are scarce. Investigating such environments with our model may show more decisive results in the aspect of structural stability.

% 4) The topology of the matrices at play is relevant
%   - stability always follows the trend connectance nestedness (insert explanation from structural stability)
%   - for the same consumption matrix : feasibility, dynamical stability and structural stability are not promoted by the same shape of matrix
%   - discuss the LRI and explain one of the reasons it has failed is why we decided to fix the connectance of the matrix (not knowing any better)
%   - link to literature :
Another clear result was the large influence of the consumption matrix topology on both stability and feasibility. In general microbial communities whose consumption matrix have a high connectance and a low ecological overlap are the ones that resist best to syntrophic interaction in the sense that their fully feasible and fully dynamically stable regions are the least impacted as syntrophy increases. This is compatible with what was said above: a higher connectance in the consumption matrix means a larger flux of biomass available to the consumers which should increase dynamical stability. Also, a larger ecological overlap means more competition between the species which lessens the available biomass flux and reduces stability.  The same trend is observed for the resistance to environmental perturbations both in the absence and presence of syntrophy. For the case of structural stability, this can also be explained intuitively: when a system is structurally perturbed, the external resources feeding rates get shuffled\footnote{By ``shuffling'', we mean that the $l_\mu$ change but their average value does not. Indeed, recall that the $\nu_\mu$ in Eq.\eqref{eq : ss methods l perturbation}, have a zero average value which implies that after the perturbation $l_0$ remains the same, and so should the other metaparameters.}, which in turn shuffles the resources available for microbial consumption: some of them start becoming more abundant, some of them get scarcer. If a given microbial species only eats a small number of resources, by luck it is possible that most of its resources got rarer after the environmental perturbation such that the biomass it can eat is not large enough for its survival anymore and it is driven to extinction. On the other hand, if said microbial species eats from many resources, it is unlikely that all the resources it consumes got scarcer after the system perturbation. The lack of biomass from the scarcer resources should indeed be compensated by the additional biomass coming from the more abundant resources, which makes the species less prone to extinction. Having a larger connectance means that on average species consume more resources, which makes the system more stable and at a given connectance, having a larger ecological overlap means that they compete more for the same resources, which implies there will be some species that eat very few resources which makes the system unstable.

The way in which the topology of the syntrophy matrix influences the dynamics is a question that deserves more exploration. On one hand, communities with a random syntrophy network seem to be less impacted but it seems like their dynamical stability is the least improved when syntrophy increases. It is also surprising that the LRI regime improves dynamical stability only when the connectance of the consumption matrix is low. That could be due to feasibility considerations: it is indeed still unclear in which conditions the strong LRI regime is feasible, and it may happen that when the connectance of the consumption matrix is too large, such a regime simply cannot exist\footnote{More specifically, the critical radius $R_C$ strongly depends on the shape of the consumption matrix and gets larger as its connectance increases. It is possible that beyond a certain connectance, $R_C$ gets too large and the inequality of Theorem \ref{theorem: strong LRI regime} cannot be fulfilled anymore.}. It could also come from the choice of the energy function used in the MCMC LRI algorithm. That energy was indeed obtained in a heuristic way that neglected some factors, especially the role of the critical radius and its dependency on the shape of the syntrophy matrix, and could be improved in a future work. It may also come from the design of the algorithm itself, which does not allow the connectance of the output matrix to be changed and therefore leaves less room to potential improvement.


% WHAT ARE THE BIOLOGICAL IMPLICATIONS?
Going back to a more biological picture, the results highlighted above allow us to state predictions about the behaviour of microbial communities. For instance we expect that the syntrophic microbial communities that can be found in Nature are fairly fine tuned: their consumers abundance at equilibrium should be very small compared to their resources abundance. Additionally, microbial species should feed from as much resources as they can but in a way that minimizes their interspecific competition. Evolutionary processes could also lead to the apparition of syntrophy. Consider for instance a microbial community that undergoes very frequent perturbations of its abundance of consumers and resources. One could imagine an experimental setup where microbes are randomly and frequently removed from the chemostat or a less artificial environment, like the human guts \cite{stein_ecological_2013}. In such an environment, if the other conditions (high consumption rate, etc.) are fulfilled, syntrophic interactions could appear through mutations to help the community increase its dynamical stability and recover faster from these perturbations. If structural perturbations were to occur, the community matrix would reshape itself to maximize the average number of resources that the species consume and to minimize interspecific competition. The syntrophy matrix would have a structure such that species release everything except what they consume.

% FINAL PART : what would I do if I had to stick with that project my whole life
The next steps in the study of syntrophic microbial communities should be both experimental and theoretical. On an experimental level, one could design a setup such as the one we described above and check the accuracy of our predictions. On the theoretical side, many challenges remain to be tackled. Among the most interesting is the search for a better energy function in the LRI algorithm which would allow us to investigate the LRI regime more thoroughly. Overall a special attention should be given to a better comprehension of the role of the structure of the syntrophy matrix. Understanding how its topology changes the dynamics will bring us to a better grasp of the underlying biological principles that shape microbial communities.

\end{document}
